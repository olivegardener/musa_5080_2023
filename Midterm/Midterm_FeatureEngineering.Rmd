---
title: "PPA_Midterm"
author: "Oliver Atwood + Dave Drennan"
date: "2023-10-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(sf)
library(ggplot2)
library(units)
library(httr)
library(rgdal)

# library(boxr)
# # Authenticate with Box
# box_auth()
```

## Read the data back in (copy-paste this to the new document)
```{r}
Sys.setenv(OGR_GEOJSON_MAX_OBJ_SIZE = "1000000")  # Set to a large value
TreeCanopy <- st_read("/Users/oliveratwood/Box Sync/PPA Midterm/data/TreeCanopy.geojson")

# !!!File corrupted
landuse <- st_read("/Users/oliveratwood/Box Sync/PPA Midterm/data/landuse.geojson")


Vacant_Lots <- st_read("data/Vacant_Lots.geojson")
Recycling_Diversion_Rate <- st_read("data/Recycling_Diversion_Rate.geojson")
Hospitals <- st_read("data/Hospitals.geojson")
Regional_Rail_Stations <- st_read("data/Regional_Rail_Stations.geojson")

Existing_Trails <- st_read("data/Existing_Trails.geojson")
Trolley_Stops <- st_read("data/Trolley_Stops.geojson")
PhillyHealth_Collisions <- st_read("data/PhillyHealth_Collisions.geojson")

trees <- st_read("data/trees.geojson")
bike_network <- st_read("data/bike_network.geojson")
parks <- st_read("data/parks.geojson")
uni <- st_read("data/uni.geojson")
neighborhoods <- st_read("data/neighborhoods.geojson")
septa <- st_read("data/septa.geojson")
landcare_lots <- st_read("data/landcare_lots.geojson")

tracts2020 <- st_read("data/tracts2020.geojson")

Houses <- st_read("data/studentData.geojson")

```

Compute min dist to trails and bike network
```{r}
# Compute distances
distances <- st_distance(Houses, bike_network)

# Compute the minimum distance for each point to the nearest line
min_distances <- apply(distances, 1, min)

# Join the minimum distances to the attribute table of the points
Houses$min_distance <- min_distances

```

Compute percent canopy cover within 500ft
```{r}
# Sample Houses for testing
n_sample <- nrow(Houses) * 0.01
Houses_sample <- st_sample(Houses, size = n_sample)

# Create buffers around each house
HouseBuffers <- st_buffer(Houses_sample, dist = 100)

# Initialize an empty vector to store the canopy coverage percent for each house
CanopyPct100ft <- vector("numeric", length = nrow(Houses_sample))

# Loop through each house buffer
for (i in 1:nrow(HouseBuffers)) {
# Calculate the intersection area between the current house buffer and the tree canopy
intersection_area <- sum(st_area(st_intersection(HouseBuffers[i, ], tree_canopy)))
  
# Calculate the canopy coverage percent for the current house buffer
CanopyPct100ft[i] <- (intersection_area / st_area(HouseBuffers[i, ])) * 100}

# Add the canopy coverage percent values to the Houses data frame
Houses$CanopyPct100ft <- CanopyPct100ft

```


```{r correlation matrix, fig.width=7, fig.height=5, fig.width=8}

#make matrix of variables we're testing
mod_vars <- Dat_A %>% 
  dplyr::select(var1, var2, var3)

#compute correlation matrix
cormatrix <- cor(mod_vars) %>% 
  round(., 2)

#plot a correlogram
corrplot(cormatrix, method = "circle", type = "lower", order = "hclust", 
         tl.col = "black", tl.srt = 45)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
